### 比赛总结
看到这个比赛的时候已经没多少时间，国庆出去了一趟回来就结束了。本来想着算了，结束后看还能提交成绩打分，就想着还是认真做一做，目标把初赛数据刷到能进复赛的分。最后刷到初赛20左右，单模型0.42213，和第一名还差了0.0006，先这样吧。冠军的经验分享很详细，大神的分享没事多看看肯定受益良多。
记录下几个关键的操作：

1.数据分析与清洗：
这次比赛基本上全是id类特征，所以基本上分析就是看看各种id对应的样本数目分布，然后看看缺失值的分布情况。因为有时间特征，所以时间上的各种id数目的分布也需要看看。从天数分布看，数据很平均，从小时看则不同时间段还是分布不太均匀。这次给了很多手机品牌、型号等id特征，比较混乱，所以做特征工程之前需要清洗异常值，填充缺失值，1_data_preprocess里面有所有的预处理，对手机相关的信息进行了填充和细分，对身份、城市等id进行了处理，提取出有效字段。uesr_tags这个多值特征进行了第一次筛选，因为id值太多，直接丢进模型很难进行有效的学习，筛选过一次后能让模型更稳定。剩余的缺失值基本上填充-1，当作一种特殊状态。

2.特征工程：
点击率预测比赛，常用的特征基本上就是统计类特征和点击率特征，基本上都扔进去分数就0.42+。这里记录下提分最明显的特征，减少了0.001+。uesr_tags这个多值特征，一开始没有怎么管，清洗完后就labelencode就扔进去了，后来觉得里面信息没有怎么学习到，就开始想怎么处理这个特征。通过将每个多值特征里面的单一id取出，统计总数后查看分布，就发现每一个id特征对应类似广告id之类的特征的分布还是有明显不同，比如下图是user_tags中每个特征值的对应广告id的点击率分布：

![输入图片说明](https://images.gitee.com/uploads/images/2018/1227/204459_575c5786_1805564.png "1545914656(1).png")

![输入图片说明](https://images.gitee.com/uploads/images/2018/1227/204623_8c6a50f5_1805564.png "1545914767(1).png")

从上图可以看出，用户属性中的每个属性值，对于不同的id类特征分布不同，可以表达每个用户属性对于各种广告还是有偏好，因此可以统计每个user_tags对于每个id类特征的数目和点击率等特征，具体操作在2_user_tags_feature-id中可以看到。这个特征工程只生成了10多个特征，加入到500+特征的特征集后依然有较大提升，说明uesr_tags的挖掘是十分重要的，能够挖掘出强特征。另外，开始对uesr_tags label encode后，训练效果一般，主要是内存不够one hot会崩掉程序，后来one hot后存入稀疏矩阵，勉强跑完了，又有差不多0.0008万分点提升，可见多值特征简单的label encode不是理想的方式，内存足够的情况下还是one hot，同时维度太大的话要考虑只提取重要值，并从其它多个维度来描述这个特征，保证信息尽量多地表达出来。另一个比较有效的特征是在kaggle的比赛分享中学习的，将特征集做stacking，得到的预测值作为新特征放入原特征集进行最终的模型训练，也能有效提分。

3.模型
模型的话还是lightgbm，速度快准确度高，本次只用了单模型，没有其它不同的特征集来做融合，也就没有考虑融合了，简单做了下bagging和stacking，没有提升，还是不同特征集融合应该更有效。看冠军的分享，也是3个不同的队员做的最终的模型然后融合。不过看我的单模型也能达到差不多的效果，可见特征工程对数据挖掘的重要性，估计还有很多强特征在uesr_tags里面没有挖掘出来，做好特征应该还能有提升。模型的参数写了个用贝叶斯优化的程序，还没来得及跑，最近公司电脑在跑模型没机会用，看有机会再试试看效果把。模型采用local cv进行本地验证，比赛时每天只能提交5次，有效的进行cv能够保证提交的有效性，而且一般来说，cv好的在b榜上面成绩好的机会更大些。

4.思考
这次比赛感觉有用的强特征没做出来几个，业务也不太懂，那些广告的flag不太理解有什么常规影响，所以flag类id特征基本上没用，如果能多了解这些flag与营销的直接影响和原理，也许可以想出来更多有效特征。基本上特征都是从用户画像的角度来设计的，考虑的个人因素居多，对于广告本身特征也不太了解，不知道是不是有些常用的组合特征能将广告本身特性和用户属性结合后与营销情况强相关，希望以后有机会参与到推荐的工作中再加紧学习把。

5.引用
1.https://zhuanlan.zhihu.com/p/47807544

2.https://zhuanlan.zhihu.com/p/38443751
